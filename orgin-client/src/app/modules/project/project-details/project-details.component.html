<div class="container mt-5">
  <h2 class="text-center text-primary mb-4">{{ 'projectDetails.title' | translate }}</h2>
  
  <!-- Error state -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">{{ 'projectDetails.loading' | translate }}</p>
  </div>

  <!-- Main Project Info Card -->
  <div *ngIf="project && !isLoading" class="card mb-4 scroll-animate">
    <div class="card-header d-flex justify-content-between align-items-center">
      {{ getProjectName() }}
      <span class="badge" [ngClass]="{
        'bg-warning': getProjectStatus() === 'PENDING',
        'bg-success': getProjectStatus() === 'APPROVED',
         'bg-danger': getProjectStatus() === 'DECLINED',
         'bg-info': getProjectStatus() === 'QUERY'
      }">
        {{ 'status.' + getProjectStatus().toLowerCase() | translate }}
      </span>
    </div>
    
    <div class="card-body">
      <!-- Project Thumbnail (only for launched and community projects) -->
      <div class="project-thumbnail mb-4" *ngIf="(isLaunchedProject() || isCommunityProject()) && getProjectPhotoUrl()">
        <img [src]="getProjectPhotoUrl()" [alt]="getProjectName()" class="img-fluid rounded">
      </div>
      
      <div class="row">
        <!-- Personal Information Card -->
        <div class="col-md-6 mb-4">
          <div class="card scroll-animate">
            <div class="card-header">
              <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.personalInfo' | translate }}</h5>
            </div>
            <div class="card-body">
              <div class="mb-2" *ngIf="getClientName()">
                <strong>{{ 'projectDetails.fullName' | translate }}:</strong> {{ getClientName() }}
              </div>
              <div class="mb-2" *ngIf="getProfessionalStatus()">
                <strong>{{ 'projectDetails.professionalStatus' | translate }}:</strong> {{ getProfessionalStatus() }}
              </div>
              <div class="mb-2" *ngIf="getCompanyName()">
                <strong>{{ 'projectDetails.companyName' | translate }}:</strong> {{ getCompanyName() }}
              </div>
              <div class="mb-2" *ngIf="getEmail()">
                <strong>{{ 'projectDetails.email' | translate }}:</strong> {{ getEmail() }}
              </div>
              <div class="mb-2" *ngIf="getPhone()">
                <strong>{{ 'projectDetails.phone' | translate }}:</strong> {{ getPhone() }}
              </div>
              <div class="mb-2" *ngIf="getLinkedIn()">
                <strong>{{ 'projectDetails.linkedin' | translate }}:</strong> 
                <a [href]="getLinkedIn()" target="_blank">{{ getLinkedIn() }}</a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Project Information Card -->
        <div class="col-md-6 mb-4">
          <div class="card scroll-animate">
            <div class="card-header">
              <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.projectInfo' | translate }}</h5>
            </div>
            <div class="card-body">
              <div class="mb-2">
                <strong>{{ 'projectLaunch.fields.projectDescription' | translate }}:</strong> 
                <span>
                  {{ truncateText(getProjectDescription(), 80) }}
                  <button 
                    *ngIf="shouldShowViewMore(getProjectDescription(), 80)" 
                    class="view-more-btn" 
                    (click)="showFullText(getProjectDescription(), 'Project Description')"
                  >
                    view more
                  </button>
                </span>
              </div>
              
              <div class="mb-2" *ngIf="getProjectType()">
                <strong>{{ 'projectLaunch.fields.projectType' | translate }}:</strong> {{ getProjectType() }}
              </div>
              
              <div class="mb-2" *ngIf="getProjectLocation()">
                <strong>{{ 'projectLaunch.fields.location' | translate }}:</strong> {{ getProjectLocation() }}
              </div>
              
              <div class="mb-2" *ngIf="getSpeciality()">
                <strong>{{ 'projectLaunch.fields.speciality' | translate }}:</strong> {{ getSpeciality() }}
              </div>
              
              <div class="mb-2" *ngIf="getTargetAudience()">
                <strong>{{ 'projectLaunch.fields.targetAudience' | translate }}:</strong> {{ getTargetAudience() }}
              </div>
              
              <div class="mb-2" *ngIf="getReferences()">
                <strong>{{ 'projectLaunch.fields.references' | translate }}:</strong> {{ getReferences() }}
              </div>
              
              <div class="mb-2" *ngIf="getBusinessIdea()">
                <strong>{{ 'projectLaunch.fields.businessIdea' | translate }}:</strong> 
                <span>
                  {{ truncateText(getBusinessIdea(), 60) }}
                  <button 
                    *ngIf="shouldShowViewMore(getBusinessIdea(), 60)" 
                    class="view-more-btn" 
                    (click)="showFullText(getBusinessIdea(), 'Business Idea')"
                  >
                    view more
                  </button>
                </span>
              </div>
              
              <div class="mb-2" *ngIf="getNeedsBusinessPlan()">
                <strong>{{ 'projectLaunch.fields.needsBusinessPlan' | translate }}:</strong> {{ getNeedsBusinessPlan() }}
              </div>
              
              <div class="mb-2" *ngIf="getWantsIP()">
                <strong>{{ 'projectLaunch.fields.wantsIP' | translate }}:</strong> {{ getWantsIP() }}
              </div>
              
              <div class="mb-2" *ngIf="getHasSponsorship()">
                <strong>{{ 'projectLaunch.fields.hasSponsorship' | translate }}:</strong> {{ getHasSponsorship() }}
              </div>
              
              <div class="mb-2" *ngIf="getSponsorName()">
                <strong>{{ 'projectLaunch.fields.sponsorName' | translate }}:</strong> {{ getSponsorName() }}
              </div>
              
              <!-- Launched project specific fields -->
              <div class="mb-2" *ngIf="getSubmittedOn()">
                <strong>{{ 'myProjects.tableHeaders.submissionDate' | translate }}:</strong> {{ getSubmittedOn() | date:'medium' }}
              </div>
              
              <div class="mb-2" *ngIf="getUpdatedOn()">
                <strong>{{ 'myProjects.tableHeaders.lastUpdated' | translate }}:</strong> {{ getUpdatedOn() | date:'medium' }}
              </div>
              
              <div class="mb-2" *ngIf="getCategory()">
                <strong>{{ 'projectLaunch.fields.category' | translate }}:</strong> {{ getCategory() }}
              </div>
              
              <div class="mb-2" *ngIf="getProjectStatusField()">
                <strong>{{ 'projectLaunch.fields.status' | translate }}:</strong> {{ getProjectStatusField() }}
              </div>
              
              <div class="mb-2" *ngIf="getPrototypeLink()">
                <strong>{{ 'projectLaunch.fields.prototypeLink' | translate }}:</strong> 
                <a [href]="getPrototypeLink()" target="_blank">{{ getPrototypeLink() }}</a>
              </div>
              
              <div class="mb-2" *ngIf="getNumberOfEmp()">
                <strong>{{ 'projectLaunch.fields.employeesCount' | translate }}:</strong> {{ getNumberOfEmp() }}
              </div>
              
                             <div class="mb-2" *ngIf="getMonthlyIncome()">
                 <strong>{{ 'projectLaunch.fields.monthlyIncome' | translate }}:</strong> {{ formatNumberWithCommas(getMonthlyIncome()) }} RWF
               </div>
              
              <div class="mb-2" *ngIf="getWebsite()">
                <strong>{{ 'projectLaunch.fields.websiteUrl' | translate }}:</strong> 
                <a [href]="getWebsite()" target="_blank">{{ getWebsite() }}</a>
              </div>
              
              <div class="mb-2" *ngIf="getNeedSponsorQ()">
                <strong>{{ 'projectLaunch.fields.needsSponsor' | translate }}:</strong> {{ getNeedSponsorQ() }}
              </div>
              
              <div class="mb-2" *ngIf="getNeedOrgQ()">
                <strong>{{ 'projectLaunch.fields.orginSponsorship' | translate }}:</strong> {{ getNeedOrgQ() }}
              </div>
              
              <div class="mb-2" *ngIf="getDoSellProjectQ()">
                <strong>{{ 'projectLaunch.fields.sellProject' | translate }}:</strong> {{ getDoSellProjectQ() }}
              </div>
              
                             <div class="mb-2" *ngIf="getProjectAmount()">
                 <strong>{{ 'projectLaunch.fields.projectInvestment' | translate }}:</strong> {{ formatNumberWithCommas(getProjectAmount()) }} RWF
               </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Team Section Card (only for community projects) -->
      <div *ngIf="isCommunityProject()" class="mb-4">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">
              {{ 'launchCommunityProject.fields.requiredMembers' | translate }}
            </h5>
          </div>
          <div class="card-body">
            <!-- Existing Team Members -->
            <div class="team-members-grid" *ngIf="hasTeamMembers()">
               <div class="team-member-card" *ngFor="let member of getTeamMembers(); let i = index">
                 <!-- Action Buttons - Always visible on left -->
                 <div class="member-actions">
                   <!-- Edit Button -->
                   <button 
                     *ngIf="editingTeamMemberIndex !== i"
                     class="btn btn-sm btn-primary edit-member-btn" 
                     (click)="startEditTeamMember(i)"
                     title="Edit team member"
                     [disabled]="deletingTeamMemberIndex === i || updatingTeamMemberIndex === i"
                   >
                     <i class="fas fa-edit"></i>
                   </button>
                   
                   <!-- Delete Button -->
                   <button 
                     class="btn btn-sm btn-danger delete-member-btn" 
                     (click)="deleteTeamMember(getCommunityProjectId(), i)"
                     title="Delete team member"
                     [disabled]="deletingTeamMemberIndex === i || updatingTeamMemberIndex === i || editingTeamMemberIndex === i"
                   >
                     <i *ngIf="deletingTeamMemberIndex !== i" class="fas fa-trash"></i>
                     <i *ngIf="deletingTeamMemberIndex === i" class="fas fa-spinner fa-spin"></i>
                   </button>
                 </div>
                 
                                   <!-- Content Area -->
                  <div class="member-content">
                    <!-- Display Mode -->
                    <div class="member-info">
                      <span class="member-title">{{ member.title }}</span>
                      <span class="member-count">{{ member.number }}</span>
                                             <span class="member-wage">{{ member.wageType }}: {{ member.wageType === 'Shares' ? member.wage + '%' : member.wageType === 'Wages' ? formatNumberWithCommas(member.wage) + ' RWF' : member.wage }}</span>
                    </div>
                  </div>
               </div>
             </div>
            
            <!-- No Team Members Message -->
            <div class="no-team-members-message text-center py-4" *ngIf="!hasTeamMembers()">
              <div class="text-muted">
                <i class="fas fa-users fa-3x mb-3"></i>
                <p class="mb-3">{{ 'projectDetails.noTeamMembers' | translate }}</p>
              </div>
            </div>
            
            <!-- Add Team Member Button -->
            <div class="add-team-member-section mt-4" *ngIf="!showAddTeamMemberForm">
              <button 
                type="button" 
                class="btn btn-primary btn-add-team-member"
                (click)="showAddTeamMemberFormSection()"
              >
                <i class="fas fa-plus me-2"></i>
                {{ 'launchCommunityProject.addTeamRequirement' | translate }}
              </button>
            </div>
            
            <!-- Add New Team Member Form -->
            <div class="add-team-member-form-section mt-4" *ngIf="showAddTeamMemberForm">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">{{ 'launchCommunityProject.addTeamRequirement' | translate }}</h6>
                </div>
                <div class="card-body">
                  <form [formGroup]="addTeamMemberForm">
                    <div formArrayName="newTeamMembers">
                      <div class="team-requirement-row" *ngFor="let memberGroup of newTeamMembers.controls; let i = index">
                        <div class="row" [formGroupName]="i">
                          <div class="col-md-4 form-group">
                            <label>{{ 'launchCommunityProject.fields.profession' | translate }} <span class="text-danger">*</span></label>
                                                         <input 
                               type="text" 
                               class="form-control" 
                               formControlName="title"
                               [placeholder]="'launchCommunityProject.placeholders.profession' | translate"
                               [disabled]="isSubmittingTeamMembers"
                             >
                          </div>
                          <div class="col-md-2 form-group">
                            <label>{{ 'launchCommunityProject.fields.quantity' | translate }} <span class="text-danger">*</span></label>
                                                         <input 
                               type="number" 
                               class="form-control" 
                               formControlName="number"
                               min="1"
                               [placeholder]="'launchCommunityProject.placeholders.quantity' | translate"
                               [disabled]="isSubmittingTeamMembers"
                             >
                          </div>
                          <div class="col-md-2 form-group">
                            <label>{{ 'launchCommunityProject.fields.wageType' | translate }} <span class="text-danger">*</span></label>
                                                         <select class="form-control" formControlName="wageType" (change)="onWageTypeChange(i)" [disabled]="isSubmittingTeamMembers">
                               <option *ngFor="let type of wageTypes" [value]="type">{{ type }}</option>
                             </select>
                          </div>
                          <div class="col-md-2 form-group" *ngIf="getTeamMemberControls(i).get('wageType')?.value !== 'Free'">
                            <label>{{ getWageLabel(getTeamMemberControls(i).get('wageType')?.value) }} <span class="text-danger">*</span></label>
                                                         <input 
                               type="number" 
                               class="form-control" 
                               formControlName="wage"
                               [min]="0"
                               [max]="getTeamMemberControls(i).get('wageType')?.value === 'Shares' ? 100 : null"
                               [step]="getTeamMemberControls(i).get('wageType')?.value === 'Shares' ? 1 : 0.1"
                               [placeholder]="getWagePlaceholder(getTeamMemberControls(i).get('wageType')?.value)"
                               [disabled]="isSubmittingTeamMembers"
                             >
                          </div>
                          <div class="col-md-2 form-group d-flex align-items-end">
                                                         <button 
                               type="button" 
                               class="btn btn-link btn-remove-requirement" 
                               (click)="removeTeamMemberRow(i)" 
                               title="{{ 'launchCommunityProject.remove' | translate }}"
                               *ngIf="newTeamMembers.length > 1"
                               [disabled]="isSubmittingTeamMembers"
                             >
                               <i class="fas fa-trash"></i>
                             </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                                         <!-- Add Another Row Button -->
                     <div class="mb-3">
                       <button type="button" class="btn btn-outline-primary btn-add-row" (click)="addTeamMemberRow()" [disabled]="isSubmittingTeamMembers">
                         <i class="fas fa-plus"></i> {{ 'launchCommunityProject.addTeamRequirement' | translate }}
                       </button>
                     </div>
                    
                                         <!-- Action Buttons -->
                     <div class="form-actions">
                       <button 
                         type="button" 
                         class="btn btn-success me-2" 
                         (click)="saveTeamMembers()"
                         [disabled]="!addTeamMemberForm.valid || newTeamMembers.length === 0 || isSubmittingTeamMembers"
                       >
                         <i *ngIf="!isSubmittingTeamMembers" class="fas fa-save me-2"></i>
                         <i *ngIf="isSubmittingTeamMembers" class="fas fa-spinner fa-spin me-2"></i>
                         {{ 'SUBMIT' | translate }}
                       </button>
                                             <button 
                         type="button" 
                         class="btn btn-warning me-2" 
                         (click)="clearTeamMemberForm()"
                         [disabled]="isSubmittingTeamMembers"
                       >
                         <i class="fas fa-eraser me-2"></i>
                         {{ 'CLEAR' | translate }}
                       </button>
                       <button 
                         type="button" 
                         class="btn btn-secondary" 
                         (click)="hideAddTeamMemberForm()"
                         [disabled]="isSubmittingTeamMembers"
                       >
                         <i class="fas fa-times me-2"></i>
                         {{ 'CANCEL' | translate }}
                       </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Analytics Section Card (only for approved launched projects) -->
      <div *ngIf="isLaunchedProject() && getProjectStatus() === 'APPROVED' && projectAnalytics" class="mb-4">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.analytics' | translate }}</h5>
          </div>
          <div class="card-body">
            <div class="row mt-3">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.totalViews' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.views }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.interactions' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.interactions }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.interestedInvestors' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.interestedInvestors }}</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-6">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.feasibility' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.feasibility.percentage }}%</p>
                    <small>{{ projectAnalytics.feasibility.reason }}</small>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.roi' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.income.roi }}%</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Documents Section Card -->
      <div class="mb-4" *ngIf="!isCommunityProject()">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.documents' | translate }}</h5>
          </div>
          <div class="card-body">
            <!-- Ordered Project Documents -->
            <div class="row mb-2 align-items-center" *ngIf="isOrderedProject() && getBusinessIdeaDocumentUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessIdeaDocument' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessIdeaDocumentUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isOrderedProject() && getBusinessPlanUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessPlan' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessPlanUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <!-- Launched Project Documents -->
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getIncomeStatementUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.incomeStatement' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getIncomeStatementUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getCashFlowUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.cashFlowStatement' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getCashFlowUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getBalanceSheetUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.balanceSheet' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBalanceSheetUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getPitchingVideoUrl()">
              <div class="col-1">
                <i class="far fa-file-video text-primary fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectDetails.pitchingVideo' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-secondary me-1" (click)="previewVideo(getPitchingVideoUrl())">
                  {{ 'projectDetails.buttons.preview' | translate }}
                </button>
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getPitchingVideoUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getBusinessPlanUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessPlan' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessPlanUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getBusinessIdeaDocumentUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessIdeaDocument' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessIdeaDocumentUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
             <!-- Admin Query/Feedback Card -->
       <div *ngIf="getProjectStatus() === 'QUERY' && getReasons()" class="mb-4">
         <div class="card scroll-animate">
           <div class="card-header">
             <h5 class="border-bottom pb-2 text-secondary">
               <i class="fas fa-comments me-2"></i>
               {{ 'projectDetails.adminQuery' | translate }}
             </h5>
           </div>
           <div class="card-body">
             <div class="alert alert-info mt-3">
               <div class="d-flex align-items-start">
                 <i class="fas fa-info-circle me-3 mt-1"></i>
                 <div class="flex-grow-1">
                   <h6 class="alert-heading mb-2">{{ 'projectDetails.updateRequired' | translate }}</h6>
                   <p class="mb-3">
                     {{ truncateText(getReasons(), 150) }}
                     <button 
                       *ngIf="shouldShowViewMore(getReasons(), 150)" 
                       class="view-more-btn" 
                       (click)="showFullText(getReasons(), 'Admin Query')"
                     >
                       view more
                     </button>
                   </p>
                   <div class="query-actions">
                     <button 
                       class="btn btn-primary me-2" 
                       (click)="updateProject()"
                       [disabled]="isUpdating"
                     >
                       <i class="fas fa-edit me-2"></i>
                       <span *ngIf="!isUpdating">{{ 'projectDetails.updateProject' | translate }}</span>
                       <span *ngIf="isUpdating">{{ 'projectDetails.updating' | translate }}</span>
                     </button>
                     <button 
                       class="btn btn-outline-secondary" 
                       (click)="resubmitProject()"
                       [disabled]="isResubmitting"
                     >
                       <i class="fas fa-paper-plane me-2"></i>
                       <span *ngIf="!isResubmitting">{{ 'projectDetails.resubmit' | translate }}</span>
                       <span *ngIf="isResubmitting">{{ 'projectDetails.resubmitting' | translate }}</span>
                     </button>
                   </div>
                 </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Feedback/Reasons Card -->
      <div *ngIf="getProjectStatus() === 'DECLINED' && getReasons()" class="mb-4">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.feedback' | translate }}</h5>
          </div>
          <div class="card-body">
            <div class="alert alert-danger mt-3">
              <p>
                {{ truncateText(getReasons(), 100) }}
                <button 
                  *ngIf="shouldShowViewMore(getReasons(), 100)" 
                  class="view-more-btn" 
                  (click)="showFullText(getReasons(), 'Feedback')"
                >
                  view more
                </button>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Back button -->
  <div class="mb-4">
    <button class="btn btn-secondary" (click)="goBack()">
      <i class="fas fa-arrow-left me-2"></i>
      {{ 'projectDetails.back' | translate }}
    </button>
  </div>
</div>

<!-- Popup Modal for Full Text -->
<div class="popup-overlay" *ngIf="showPopup" (click)="closePopup()">
  <div class="popup-content" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <h3>{{ popupTitle }}</h3>
      <button class="popup-close" (click)="closePopup()">
        <i class="material-icons">close</i>
      </button>
    </div>
    <div class="popup-body">
      <p>{{ popupContent }}</p>
    </div>
  </div>
</div>

 <!-- Video Preview Modal -->
 <ng-template #videoPreviewModal let-modal>
   <div class="modal-header">
     <h5 class="modal-title">{{ 'projectDetails.videoPreview' | translate }}</h5>
     <button type="button" class="btn-close" (click)="modal.dismiss()" aria-label="Close"></button>
   </div>
   <div class="modal-body">
     <video controls class="w-100" #videoPreview>
       <source [src]="currentVideoUrl" type="video/mp4">
       Your browser does not support the video tag.
     </video>
   </div>
   <div class="modal-footer">
     <button type="button" class="btn btn-secondary" (click)="modal.close()">{{ 'projectDetails.buttons.close' | translate }}</button>
   </div>
 </ng-template>

 <!-- Update Team Member Modal -->
 <div class="modal fade show" [class.d-block]="showUpdateTeamMemberModal" tabindex="-1" role="dialog" *ngIf="showUpdateTeamMemberModal">
   <div class="modal-dialog modal-lg" role="document">
     <div class="modal-content">
       <div class="modal-header">
         <h5 class="modal-title">
           <i class="fas fa-edit me-2"></i>
           {{ 'projectDetails.updateTeamMember' | translate }}
         </h5>
         <button type="button" class="btn-close" (click)="closeUpdateTeamMemberModal()" aria-label="Close"></button>
       </div>
       <div class="modal-body" *ngIf="updatingTeamMember">
         <form>
           <div class="row">
             <div class="col-md-6 form-group mb-3">
               <label for="updateTitle">{{ 'launchCommunityProject.fields.profession' | translate }} <span class="text-danger">*</span></label>
                                <input 
                   type="text" 
                   class="form-control" 
                   id="updateTitle"
                   [(ngModel)]="updatingTeamMember.title"
                   name="title"
                   placeholder="{{ 'launchCommunityProject.placeholders.profession' | translate }}"
                   [disabled]="isUpdatingTeamMember"
                 >
             </div>
             <div class="col-md-6 form-group mb-3">
               <label for="updateNumber">{{ 'launchCommunityProject.fields.quantity' | translate }} <span class="text-danger">*</span></label>
               <input 
                 type="number" 
                 class="form-control" 
                 id="updateNumber"
                 [(ngModel)]="updatingTeamMember.number"
                 name="number"
                 min="1"
                 placeholder="{{ 'launchCommunityProject.placeholders.quantity' | translate }}"
                 [disabled]="isUpdatingTeamMember"
               >
             </div>
           </div>
           <div class="row">
             <div class="col-md-6 form-group mb-3">
               <label for="updateWageType">{{ 'launchCommunityProject.fields.wageType' | translate }} <span class="text-danger">*</span></label>
               <select 
                 class="form-control" 
                 id="updateWageType"
                 [(ngModel)]="updatingTeamMember.wageType"
                 name="wageType"
                 (change)="onUpdateModalWageTypeChange()"
                 [disabled]="isUpdatingTeamMember"
               >
                 <option *ngFor="let type of wageTypes" [value]="type">{{ type }}</option>
               </select>
             </div>
             <div class="col-md-6 form-group mb-3" *ngIf="updatingTeamMember.wageType !== 'Free'">
               <label for="updateWage">{{ getWageLabel(updatingTeamMember.wageType) }} <span class="text-danger">*</span></label>
               <input 
                 type="number" 
                 class="form-control" 
                 id="updateWage"
                 [(ngModel)]="updatingTeamMember.wage"
                 name="wage"
                 [min]="0"
                 [max]="updatingTeamMember.wageType === 'Shares' ? 100 : null"
                 [step]="updatingTeamMember.wageType === 'Shares' ? 1 : 0.1"
                 [placeholder]="getWagePlaceholder(updatingTeamMember.wageType)"
                 [disabled]="isUpdatingTeamMember"
               >
             </div>
           </div>
         </form>
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-secondary" (click)="closeUpdateTeamMemberModal()">
           <i class="fas fa-times me-2"></i>
           {{ 'CANCEL' | translate }}
         </button>
         <button 
           type="button" 
           class="btn btn-success" 
           (click)="updateTeamMemberFromModal()"
           [disabled]="!updatingTeamMember || !updatingTeamMember.title || updatingTeamMember.number < 1 || isUpdatingTeamMember"
         >
           <i *ngIf="!isUpdatingTeamMember" class="fas fa-save me-2"></i>
           <i *ngIf="isUpdatingTeamMember" class="fas fa-spinner fa-spin me-2"></i>
           {{ 'SAVE' | translate }}
         </button>
       </div>
     </div>
   </div>
 </div>

 <!-- Modal Backdrop -->
 <div class="modal-backdrop fade show" *ngIf="showUpdateTeamMemberModal"></div>