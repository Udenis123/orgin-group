<div class="container mt-5">
  <h2 class="text-center text-primary mb-4">{{ 'projectDetails.title' | translate }}</h2>
  
  <!-- Error state -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">{{ 'projectDetails.loading' | translate }}</p>
  </div>

  <!-- Main Project Info Card -->
  <div *ngIf="project && !isLoading" class="card mb-4 scroll-animate">
    <div class="card-header d-flex justify-content-between align-items-center">
      {{ getProjectName() }}
      <span class="badge" [ngClass]="{
        'bg-warning': getProjectStatus() === 'PENDING',
        'bg-success': getProjectStatus() === 'APPROVED',
        'bg-danger': getProjectStatus() === 'DECLINED'
      }">
        {{ 'status.' + getProjectStatus().toLowerCase() | translate }}
      </span>
    </div>
    
    <div class="card-body">
      <!-- Project Thumbnail (only for launched and community projects) -->
      <div class="project-thumbnail mb-4" *ngIf="(isLaunchedProject() || isCommunityProject()) && getProjectPhotoUrl()">
        <img [src]="getProjectPhotoUrl()" [alt]="getProjectName()" class="img-fluid rounded">
      </div>
      
      <div class="row">
        <!-- Personal Information Card -->
        <div class="col-md-6 mb-4">
          <div class="card scroll-animate">
            <div class="card-header">
              <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.personalInfo' | translate }}</h5>
            </div>
            <div class="card-body">
              <div class="mb-2" *ngIf="getClientName()">
                <strong>{{ 'projectDetails.fullName' | translate }}:</strong> {{ getClientName() }}
              </div>
              <div class="mb-2" *ngIf="getProfessionalStatus()">
                <strong>{{ 'projectDetails.professionalStatus' | translate }}:</strong> {{ getProfessionalStatus() }}
              </div>
              <div class="mb-2" *ngIf="getCompanyName()">
                <strong>{{ 'projectDetails.companyName' | translate }}:</strong> {{ getCompanyName() }}
              </div>
              <div class="mb-2" *ngIf="getEmail()">
                <strong>{{ 'projectDetails.email' | translate }}:</strong> {{ getEmail() }}
              </div>
              <div class="mb-2" *ngIf="getPhone()">
                <strong>{{ 'projectDetails.phone' | translate }}:</strong> {{ getPhone() }}
              </div>
              <div class="mb-2" *ngIf="getLinkedIn()">
                <strong>{{ 'projectDetails.linkedin' | translate }}:</strong> 
                <a [href]="getLinkedIn()" target="_blank">{{ getLinkedIn() }}</a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Project Information Card -->
        <div class="col-md-6 mb-4">
          <div class="card scroll-animate">
            <div class="card-header">
              <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.projectInfo' | translate }}</h5>
            </div>
            <div class="card-body">
              <div class="mb-2">
                <strong>{{ 'projectLaunch.fields.projectDescription' | translate }}:</strong> 
                <span>
                  {{ truncateText(getProjectDescription(), 80) }}
                  <button 
                    *ngIf="shouldShowViewMore(getProjectDescription(), 80)" 
                    class="view-more-btn" 
                    (click)="showFullText(getProjectDescription(), 'Project Description')"
                  >
                    view more
                  </button>
                </span>
              </div>
              
              <div class="mb-2" *ngIf="getProjectType()">
                <strong>{{ 'projectLaunch.fields.projectType' | translate }}:</strong> {{ getProjectType() }}
              </div>
              
              <div class="mb-2" *ngIf="getProjectLocation()">
                <strong>{{ 'projectLaunch.fields.location' | translate }}:</strong> {{ getProjectLocation() }}
              </div>
              
              <div class="mb-2" *ngIf="getSpeciality()">
                <strong>{{ 'projectLaunch.fields.speciality' | translate }}:</strong> {{ getSpeciality() }}
              </div>
              
              <div class="mb-2" *ngIf="getTargetAudience()">
                <strong>{{ 'projectLaunch.fields.targetAudience' | translate }}:</strong> {{ getTargetAudience() }}
              </div>
              
              <div class="mb-2" *ngIf="getReferences()">
                <strong>{{ 'projectLaunch.fields.references' | translate }}:</strong> {{ getReferences() }}
              </div>
              
              <div class="mb-2" *ngIf="getBusinessIdea()">
                <strong>{{ 'projectLaunch.fields.businessIdea' | translate }}:</strong> 
                <span>
                  {{ truncateText(getBusinessIdea(), 60) }}
                  <button 
                    *ngIf="shouldShowViewMore(getBusinessIdea(), 60)" 
                    class="view-more-btn" 
                    (click)="showFullText(getBusinessIdea(), 'Business Idea')"
                  >
                    view more
                  </button>
                </span>
              </div>
              
              <div class="mb-2" *ngIf="getNeedsBusinessPlan()">
                <strong>{{ 'projectLaunch.fields.needsBusinessPlan' | translate }}:</strong> {{ getNeedsBusinessPlan() }}
              </div>
              
              <div class="mb-2" *ngIf="getWantsIP()">
                <strong>{{ 'projectLaunch.fields.wantsIP' | translate }}:</strong> {{ getWantsIP() }}
              </div>
              
              <div class="mb-2" *ngIf="getHasSponsorship()">
                <strong>{{ 'projectLaunch.fields.hasSponsorship' | translate }}:</strong> {{ getHasSponsorship() }}
              </div>
              
              <div class="mb-2" *ngIf="getSponsorName()">
                <strong>{{ 'projectLaunch.fields.sponsorName' | translate }}:</strong> {{ getSponsorName() }}
              </div>
              
              <!-- Launched project specific fields -->
              <div class="mb-2" *ngIf="getSubmittedOn()">
                <strong>{{ 'myProjects.tableHeaders.submissionDate' | translate }}:</strong> {{ getSubmittedOn() | date:'medium' }}
              </div>
              
              <div class="mb-2" *ngIf="getUpdatedOn()">
                <strong>{{ 'myProjects.tableHeaders.lastUpdated' | translate }}:</strong> {{ getUpdatedOn() | date:'medium' }}
              </div>
              
              <div class="mb-2" *ngIf="getCategory()">
                <strong>{{ 'projectLaunch.fields.category' | translate }}:</strong> {{ getCategory() }}
              </div>
              
              <div class="mb-2" *ngIf="getProjectStatusField()">
                <strong>{{ 'projectLaunch.fields.status' | translate }}:</strong> {{ getProjectStatusField() }}
              </div>
              
              <div class="mb-2" *ngIf="getPrototypeLink()">
                <strong>{{ 'projectLaunch.fields.prototypeLink' | translate }}:</strong> 
                <a [href]="getPrototypeLink()" target="_blank">{{ getPrototypeLink() }}</a>
              </div>
              
              <div class="mb-2" *ngIf="getNumberOfEmp()">
                <strong>{{ 'projectLaunch.fields.employeesCount' | translate }}:</strong> {{ getNumberOfEmp() }}
              </div>
              
              <div class="mb-2" *ngIf="getMonthlyIncome()">
                <strong>{{ 'projectLaunch.fields.monthlyIncome' | translate }}:</strong> {{ getMonthlyIncome() | currency }}
              </div>
              
              <div class="mb-2" *ngIf="getWebsite()">
                <strong>{{ 'projectLaunch.fields.websiteUrl' | translate }}:</strong> 
                <a [href]="getWebsite()" target="_blank">{{ getWebsite() }}</a>
              </div>
              
              <div class="mb-2" *ngIf="getNeedSponsorQ()">
                <strong>{{ 'projectLaunch.fields.needsSponsor' | translate }}:</strong> {{ getNeedSponsorQ() }}
              </div>
              
              <div class="mb-2" *ngIf="getNeedOrgQ()">
                <strong>{{ 'projectLaunch.fields.orginSponsorship' | translate }}:</strong> {{ getNeedOrgQ() }}
              </div>
              
              <div class="mb-2" *ngIf="getDoSellProjectQ()">
                <strong>{{ 'projectLaunch.fields.sellProject' | translate }}:</strong> {{ getDoSellProjectQ() }}
              </div>
              
              <div class="mb-2" *ngIf="getProjectAmount()">
                <strong>{{ 'projectLaunch.fields.projectInvestment' | translate }}:</strong> {{ getProjectAmount() | currency }}
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Team Section Card (only for community projects) -->
      <div *ngIf="isCommunityProject() && hasTeamMembers()" class="mb-4">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">
              {{ 'launchCommunityProject.fields.requiredMembers' | translate }}
            </h5>
          </div>
          <div class="card-body">
            <div class="team-members-grid">
              <div class="team-member-card" *ngFor="let member of getTeamMembers()">
                <div class="member-info">
                  <span class="member-title">{{ member.title }}</span>
                  <span class="member-count">{{ member.number }}</span>
                </div>
              </div>
            </div>
            
            <!-- Add Team Member Button -->
            <div class="add-team-member-section mt-4" *ngIf="!showAddTeamMemberForm">
              <button 
                type="button" 
                class="btn btn-primary btn-add-team-member"
                (click)="showAddTeamMemberFormSection()"
              >
                <i class="fas fa-plus me-2"></i>
                {{ 'launchCommunityProject.addTeamRequirement' | translate }}
              </button>
            </div>
            
            <!-- Add New Team Member Form -->
            <div class="add-team-member-form-section mt-4" *ngIf="showAddTeamMemberForm">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">{{ 'launchCommunityProject.addTeamRequirement' | translate }}</h6>
                </div>
                <div class="card-body">
                  <form [formGroup]="addTeamMemberForm">
                    <div formArrayName="newTeamMembers">
                      <div class="team-requirement-row" *ngFor="let memberGroup of newTeamMembers.controls; let i = index">
                        <div class="row" [formGroupName]="i">
                          <div class="col-md-5 form-group">
                            <label>{{ 'launchCommunityProject.fields.profession' | translate }} <span class="text-danger">*</span></label>
                            <input 
                              type="text" 
                              class="form-control" 
                              formControlName="title"
                              [placeholder]="'launchCommunityProject.placeholders.profession' | translate"
                            >
                          </div>
                          <div class="col-md-3 form-group">
                            <label>{{ 'launchCommunityProject.fields.quantity' | translate }} <span class="text-danger">*</span></label>
                            <input 
                              type="number" 
                              class="form-control" 
                              formControlName="number"
                              min="1"
                              [placeholder]="'launchCommunityProject.placeholders.quantity' | translate"
                            >
                          </div>
                          <div class="col-md-2 form-group d-flex align-items-end">
                            <button 
                              type="button" 
                              class="btn btn-link btn-remove-requirement" 
                              (click)="removeTeamMemberRow(i)" 
                              title="{{ 'launchCommunityProject.remove' | translate }}"
                              *ngIf="newTeamMembers.length > 1"
                            >
                              <i class="fas fa-trash"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Add Another Row Button -->
                    <div class="mb-3">
                      <button type="button" class="btn btn-outline-primary btn-add-row" (click)="addTeamMemberRow()">
                        <i class="fas fa-plus"></i> {{ 'launchCommunityProject.addTeamRequirement' | translate }}
                      </button>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="form-actions">
                      <button 
                        type="button" 
                        class="btn btn-success me-2" 
                        (click)="saveTeamMembers()"
                        [disabled]="!addTeamMemberForm.valid || newTeamMembers.length === 0"
                      >
                        <i class="fas fa-save me-2"></i>
                        {{ 'SUBMIT' | translate }}
                      </button>
                      <button 
                        type="button" 
                        class="btn btn-warning me-2" 
                        (click)="clearTeamMemberForm()"
                      >
                        <i class="fas fa-eraser me-2"></i>
                        {{ 'CLEAR' | translate }}
                      </button>
                      <button 
                        type="button" 
                        class="btn btn-secondary" 
                        (click)="hideAddTeamMemberForm()"
                      >
                        <i class="fas fa-times me-2"></i>
                        {{ 'CANCEL' | translate }}
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Analytics Section Card (only for approved launched projects) -->
      <div *ngIf="isLaunchedProject() && getProjectStatus() === 'APPROVED' && projectAnalytics" class="mb-4">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.analytics' | translate }}</h5>
          </div>
          <div class="card-body">
            <div class="row mt-3">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.totalViews' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.views }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.interactions' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.interactions }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.interestedInvestors' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.interestedInvestors }}</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-6">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.feasibility' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.feasibility.percentage }}%</p>
                    <small>{{ projectAnalytics.feasibility.reason }}</small>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card">
                  <div class="card-body">
                    <h6>{{ 'projectDetails.roi' | translate }}</h6>
                    <p class="h3">{{ projectAnalytics.income.roi }}%</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Documents Section Card -->
      <div class="mb-4" *ngIf="!isCommunityProject()">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.documents' | translate }}</h5>
          </div>
          <div class="card-body">
            <!-- Ordered Project Documents -->
            <div class="row mb-2 align-items-center" *ngIf="isOrderedProject() && getBusinessIdeaDocumentUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessIdeaDocument' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessIdeaDocumentUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isOrderedProject() && getBusinessPlanUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessPlan' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessPlanUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <!-- Launched Project Documents -->
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getIncomeStatementUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.incomeStatement' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getIncomeStatementUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getCashFlowUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.cashFlowStatement' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getCashFlowUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getBalanceSheetUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.balanceSheet' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBalanceSheetUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getPitchingVideoUrl()">
              <div class="col-1">
                <i class="far fa-file-video text-primary fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectDetails.pitchingVideo' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-secondary me-1" (click)="previewVideo(getPitchingVideoUrl())">
                  {{ 'projectDetails.buttons.preview' | translate }}
                </button>
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getPitchingVideoUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getBusinessPlanUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessPlan' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessPlanUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
            
            <div class="row mb-2 align-items-center" *ngIf="isLaunchedProject() && getBusinessIdeaDocumentUrl()">
              <div class="col-1">
                <i class="far fa-file-pdf text-danger fa-2x"></i>
              </div>
              <div class="col-8">
                {{ 'projectLaunch.fields.businessIdeaDocument' | translate }}
              </div>
              <div class="col-3 text-end">
                <button class="btn btn-sm btn-primary" (click)="downloadDocument(getBusinessIdeaDocumentUrl())">
                  {{ 'projectDetails.buttons.download' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Feedback/Reasons Card -->
      <div *ngIf="getProjectStatus() === 'DECLINED' && getReasons()" class="mb-4">
        <div class="card scroll-animate">
          <div class="card-header">
            <h5 class="border-bottom pb-2 text-secondary">{{ 'projectDetails.feedback' | translate }}</h5>
          </div>
          <div class="card-body">
            <div class="alert alert-danger mt-3">
              <p>
                {{ truncateText(getReasons(), 100) }}
                <button 
                  *ngIf="shouldShowViewMore(getReasons(), 100)" 
                  class="view-more-btn" 
                  (click)="showFullText(getReasons(), 'Feedback')"
                >
                  view more
                </button>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Back button -->
  <div class="mb-4">
    <button class="btn btn-secondary" (click)="goBack()">
      <i class="fas fa-arrow-left me-2"></i>
      {{ 'projectDetails.back' | translate }}
    </button>
  </div>
</div>

<!-- Popup Modal for Full Text -->
<div class="popup-overlay" *ngIf="showPopup" (click)="closePopup()">
  <div class="popup-content" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <h3>{{ popupTitle }}</h3>
      <button class="popup-close" (click)="closePopup()">
        <i class="material-icons">close</i>
      </button>
    </div>
    <div class="popup-body">
      <p>{{ popupContent }}</p>
    </div>
  </div>
</div>

<!-- Video Preview Modal -->
<ng-template #videoPreviewModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">{{ 'projectDetails.videoPreview' | translate }}</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss()" aria-label="Close"></button>
  </div>
  <div class="modal-body">
    <video controls class="w-100" #videoPreview>
      <source [src]="currentVideoUrl" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">{{ 'projectDetails.buttons.close' | translate }}</button>
  </div>
</ng-template>