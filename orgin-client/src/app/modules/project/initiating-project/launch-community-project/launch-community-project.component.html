<div class="container mt-5">
    <h2>{{ 'sidenav.links.launch_community_project' | translate }}</h2>
    <form [formGroup]="projectForm" (ngSubmit)="onSubmit()">
        
        <!-- Step 1: Personal Information -->
        <div *ngIf="currentStep === 0" class="card mb-3">
            <div class="card-header">{{ 'launchCommunityProject.steps.personalInformation' | translate }}</div>
            <div class="card-body">
                <small class="text-muted">{{ 'launchCommunityProject.mandatoryFieldsNote' | translate }}</small>
                <div class="row">
                    <div class="col-md-6 form-group">
                        <label for="fullName">{{ 'launchCommunityProject.fields.fullName' | translate }} <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="fullName" formControlName="fullName">
                        <div *ngIf="projectForm.get('fullName')?.invalid && projectForm.get('fullName')?.touched" class="text-danger">
                            {{ 'launchCommunityProject.errors.fullNameRequired' | translate }}
                        </div>
                    </div>
                    <div class="col-md-6 form-group">
                        <label for="professionalStatus">{{ 'launchCommunityProject.fields.professionalStatus' | translate }} <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="professionalStatus" formControlName="professionalStatus">
                    </div>
                    <div class="col-md-6 form-group">
                        <label for="email">{{ 'launchCommunityProject.fields.email' | translate }} <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="email" formControlName="email">
                        <div *ngIf="projectForm.get('email')?.invalid && projectForm.get('email')?.touched" class="text-danger">
                            <span *ngIf="projectForm.get('email')?.errors?.['required']">{{ 'launchCommunityProject.errors.emailRequired' | translate }}</span>
                            <span *ngIf="projectForm.get('email')?.errors?.['email']">{{ 'launchCommunityProject.errors.emailInvalid' | translate }}</span>
                        </div>
                    </div>
                    <div class="col-md-6 form-group">
                        <label for="phone">{{ 'launchCommunityProject.fields.phone' | translate }} <span class="text-danger">*</span></label>
                        <input type="tel" class="form-control" id="phone" formControlName="phone">
                    </div>
                    <div class="col-md-12 form-group">
                        <label for="linkedin">{{ 'launchCommunityProject.fields.linkedin' | translate }}</label>
                        <input type="url" class="form-control" id="linkedin" formControlName="linkedin" placeholder="https://www.linkedin.com/in/your-profile">
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Project Information -->
        <div *ngIf="currentStep === 1" class="card mb-3">
            <div class="card-header">{{ 'launchCommunityProject.steps.projectInformation' | translate }}</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12 form-group">
                        <label for="projectThumbnail">{{ 'launchCommunityProject.fields.projectThumbnail' | translate }}</label>
                        <div class="input-group">
                            <input type="text" class="form-control" [value]="(fileReferences['projectThumbnail']?.name) || 'No file chosen'" readonly>
                            <button class="btn btn-outline-secondary" type="button" (click)="fileInput.click()">Choose File</button>
                            <input type="file" class="form-control" id="projectThumbnail" #fileInput style="display: none;" (change)="onFileChange($event, 'projectThumbnail')" accept="image/*">
                        </div>
                    </div>
                    <div class="col-md-6 form-group">
                        <label for="projectName">{{ 'launchCommunityProject.fields.projectName' | translate }} <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="projectName" formControlName="projectName">
                    </div>
                    <div class="col-md-6 form-group">
                        <label for="category">{{ 'launchCommunityProject.fields.category' | translate }} <span class="text-danger">*</span></label>
                        <select class="form-control" id="category" formControlName="category" (change)="onCategoryChange()">
                            <option value="">{{ 'launchCommunityProject.selectCategory' | translate }}</option>
                            <option *ngFor="let category of projectCategories" [value]="category">{{ category | translate }}</option>
                        </select>
                        <div *ngIf="projectForm.get('category')?.invalid && projectForm.get('category')?.touched" class="text-danger">
                            {{ 'launchCommunityProject.errors.categoryRequired' | translate }}
                        </div>
                    </div>
                    <div class="col-md-6 form-group" *ngIf="projectForm.get('category')?.value === 'Other'">
                        <label for="otherCategory">{{ 'launchCommunityProject.fields.otherCategory' | translate }} <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="otherCategory" formControlName="otherCategory">
                        <div *ngIf="projectForm.get('otherCategory')?.invalid && projectForm.get('otherCategory')?.touched" class="text-danger">
                            {{ 'launchCommunityProject.errors.otherCategoryRequired' | translate }}
                        </div>
                    </div>
                    <div class="col-md-6 form-group">
                        <label for="location">{{ 'launchCommunityProject.fields.location' | translate }} <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="location" formControlName="location">
                    </div>
                    <div class="col-md-12 form-group">
                        <label for="description">{{ 'launchCommunityProject.fields.description' | translate }} <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="description" formControlName="description" rows="5"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Team Requirements -->
        <div *ngIf="currentStep === 2" class="card mb-3">
            <div class="card-header">{{ 'launchCommunityProject.steps.teamRequirements' | translate }}</div>
            <div class="card-body">
                <div class="mb-3">
                    <button type="button" class="btn btn-primary btn-add-requirement" (click)="addTeamRequirement()">
                        <i class="fas fa-plus"></i> {{ 'launchCommunityProject.addTeamRequirement' | translate }}
                    </button>
                </div>
                
                <div *ngIf="requiredMembers.length === 0" class="no-requirements-message">
                    {{ 'launchCommunityProject.noTeamRequirements' | translate }}
                </div>
                
                <div class="team-requirement-row" *ngFor="let memberGroup of requiredMembers.controls; let i = index">
                    <div class="row">
                        <div class="col-md-4 form-group">
                            <label>{{ 'launchCommunityProject.fields.profession' | translate }} <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" [formControl]="getTitleControl(i)" 
                                   [placeholder]="'launchCommunityProject.placeholders.profession' | translate">
                            <div *ngIf="getTitleControl(i).invalid && getTitleControl(i).touched" class="text-danger">
                                {{ 'launchCommunityProject.errors.professionRequired' | translate }}
                            </div>
                        </div>
                        <div class="col-md-2 form-group">
                            <label>{{ 'launchCommunityProject.fields.quantity' | translate }} <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" [formControl]="getNumberControl(i)" 
                                   min="1" [placeholder]="'launchCommunityProject.placeholders.quantity' | translate">
                            <div *ngIf="getNumberControl(i).invalid && getNumberControl(i).touched" class="text-danger">
                                {{ 'launchCommunityProject.errors.quantityRequired' | translate }}
                            </div>
                        </div>
                        <div class="col-md-2 form-group">
                            <label>{{ 'launchCommunityProject.fields.wageType' | translate }} <span class="text-danger">*</span></label>
                            <select class="form-control" [formControl]="getWageTypeControl(i)" (change)="onWageTypeChange(i)">
                                <option *ngFor="let wageType of wageTypes" [value]="wageType.value">
                                    {{ wageType.label }}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2 form-group" *ngIf="getWageTypeControl(i).value !== 'Free'">
                            <label>{{ getWageLabel(getWageTypeControl(i).value) }} <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" [formControl]="getWageControl(i)" 
                                   [placeholder]="getWagePlaceholder(getWageTypeControl(i).value)"
                                   [min]="getWageTypeControl(i).value === 'Shares' ? 0 : 0"
                                   [max]="getWageTypeControl(i).value === 'Shares' ? 100 : null"
                                   [step]="getWageTypeControl(i).value === 'Shares' ? 0.1 : 1">
                            <div *ngIf="getWageControl(i).invalid && getWageControl(i).touched" class="text-danger">
                                <span *ngIf="getWageControl(i).errors?.['required']">{{ 'launchCommunityProject.errors.wageRequired' | translate }}</span>
                                <span *ngIf="getWageControl(i).errors?.['min']">{{ 'launchCommunityProject.errors.wageMin' | translate }}</span>
                                <span *ngIf="getWageControl(i).errors?.['max']">{{ 'launchCommunityProject.errors.wageMax' | translate }}</span>
                            </div>
                        </div>
                        <div class="col-md-2 form-group d-flex align-items-end">
                            <button type="button" class="btn btn-link btn-remove-requirement" (click)="removeTeamRequirement(i)" title="{{ 'launchCommunityProject.remove' | translate }}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Review and Submit -->
        <div *ngIf="currentStep === 3" class="card mb-3">
            <div class="card-header">{{ 'launchCommunityProject.steps.reviewAndSubmit' | translate }}</div>
            <div class="card-body">
                <!-- Review content here -->
                <div class="form-group mt-4">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="confirmationCheckbox" formControlName="confirmationCheckbox">
                        <label class="form-check-label" for="confirmationCheckbox">
                            {{ 'launchCommunityProject.confirmationStatement' | translate }}
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="text-center">
            <button type="button" class="btn btn-secondary me-2" *ngIf="currentStep > 0" (click)="previousStep()">
                {{ 'PREVIOUS' | translate }}
            </button>
            <button type="button" class="btn btn-success me-2" *ngIf="currentStep < steps.length - 1" (click)="nextStep()">
                {{ 'CONTINUE' | translate }}
            </button>
            <button type="button" class="btn btn-danger me-2" (click)="onClear()">
                {{ 'CLEAR' | translate }}
            </button>
            <button type="submit" class="btn btn-success" *ngIf="currentStep === steps.length - 1" 
                    [disabled]="!projectForm.valid || requiredMembers.length === 0 || isSubmitting"
                    (click)="markFormAsTouched()">
              <span *ngIf="!isSubmitting">{{ 'SUBMIT' | translate }}</span>
              <span *ngIf="isSubmitting">
                <i class="fas fa-spinner fa-spin me-2"></i>
                {{ 'SUBMIT' | translate }}...
              </span>
            </button>
        </div>
    </form>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" *ngIf="isSubmitting">
  <div class="loading-content">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">{{ 'SUBMIT' | translate }}...</p>
  </div>
</div>
