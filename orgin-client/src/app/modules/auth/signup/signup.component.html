<div class="signup-container">
  <h2>Sign Up </h2>
  <div class="encouragement-message">{{ getEncouragementMessage() }}</div>

  <!-- Error message display -->
  <div *ngIf="errorMessage" class="error-alert">
    {{ errorMessage }}
  </div>

  <form [formGroup]="signupForm" (ngSubmit)="onSubmit()">
    
    <!-- Step 1 - Personal Information -->
    <div *ngIf="currentStep === 1" class="form-pair">
      <div class="form-group">
        <label for="fullName">Full Name</label>
        <input id="fullName" type="text" formControlName="fullName" required />
        <div *ngIf="signupForm.get('fullName')?.invalid && signupForm.get('fullName')?.touched" class="error-message">
          Full name is required and must be at least 10 characters
        </div>
      </div>
      
      <div class="form-group">
        <label for="idNumber">ID Number</label>
        <input id="idNumber" type="text" formControlName="idNumber" required />
        <div *ngIf="signupForm.get('idNumber')?.invalid && signupForm.get('idNumber')?.touched" class="error-message">
          ID number must be exactly 16 digits
        </div>
      </div>

      <div class="form-group">
        <label for="gender">Gender</label>
        <select id="gender" formControlName="gender" required>
          <option value="">Select gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <div *ngIf="signupForm.get('gender')?.invalid && signupForm.get('gender')?.touched" class="error-message">
          Gender is required
        </div>
      </div>

      <div class="form-group">
        <label for="nationality">Nationality</label>
        <input id="nationality" type="text" formControlName="nationality" required />
        <div *ngIf="signupForm.get('nationality')?.invalid && signupForm.get('nationality')?.touched" class="error-message">
          Nationality is required
        </div>
      </div>
    </div>

    <!-- Step 2 - Contact Information -->
    <div *ngIf="currentStep === 2" class="form-pair">
      <div class="form-group">
        <label for="profession">Profession</label>
        <input id="profession" type="text" formControlName="profession" required />
        <div *ngIf="signupForm.get('profession')?.invalid && signupForm.get('profession')?.touched" class="error-message">
          Profession is required and must be at least 5 characters
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input id="email" type="email" formControlName="email" required />
        <div *ngIf="signupForm.get('email')?.invalid && signupForm.get('email')?.touched" class="error-message">
          Please enter a valid email address
        </div>
      </div>

      <div class="form-group">
        <label for="country">Country</label>
        <select id="country" formControlName="country" (change)="onCountryChange($event)" required>
          <option *ngIf="loadingCountries" value="" disabled>Select country</option>
          <option *ngFor="let country of countries" 
                  [value]="country.code">
            {{ country.name }} ({{ getCountryCode(country.code) }})
          </option>
        </select>
        <div *ngIf="signupForm.get('country')?.invalid && signupForm.get('country')?.touched" class="error-message">
          Country is required
        </div>
      </div>

      <div class="form-group">
        <label for="phoneNumber">Phone Number</label>
        <input id="phoneNumber" type="tel" formControlName="phoneNumber" placeholder="Enter phone number (9-15 digits)" required />
        <div *ngIf="signupForm.get('phoneNumber')?.invalid && signupForm.get('phoneNumber')?.touched" class="error-message">
          {{ getPhoneNumberErrors() }}
        </div>
      </div>
    </div>

    <!-- Step 3 - Account Setup -->
    <div *ngIf="currentStep === 3" class="form-pair">
      <div class="form-group">
        <label for="password">Password</label>
        <input id="password" type="password" formControlName="password" required />
        <div *ngIf="signupForm.get('password')?.invalid && signupForm.get('password')?.touched" class="error-message">
          {{ getPasswordErrors() }}
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <input id="confirmPassword" type="password" formControlName="confirmPassword" required />
        <div *ngIf="signupForm.errors?.['mismatch'] && signupForm.get('confirmPassword')?.touched" class="error-message">
          Passwords do not match
        </div>
      </div>
    </div>

    <!-- Navigation Controls -->
    <div class="navigation-buttons">
      <button *ngIf="currentStep > 1" type="button" class="nav-button" (click)="prevStep()">Previous</button>
      <button *ngIf="currentStep < 3" type="button" class="nav-button" 
              (click)="nextStep()" [disabled]="!isStepValid(currentStep)">
        Next
      </button>
      <button *ngIf="currentStep === 3" type="submit" class="submit-button" 
              [disabled]="signupForm.invalid || isSubmitting">
        {{ isSubmitting ? 'Signing Up...' : 'Sign Up' }}
      </button>
    </div>

  </form>

  <p>Already have an account? <a routerLink="/login">Login</a></p>
</div>