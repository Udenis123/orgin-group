<div class="container">
  <h1>{{ 'submittedProjects.assignedLaunchedProjects' | translate }}</h1>
  
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <app-loading message="Loading launched projects..."></app-loading>
  </div>

  <!-- Error State -->
  <div *ngIf="isError && !isLoading" class="error-container">
    <div class="error-content">
      <i class="material-icons error-icon">error_outline</i>
      <h3>Error Loading Projects</h3>
      <p>{{ errorMessage }}</p>
      <button class="retry-button" (click)="retryLoading()">
        <i class="material-icons">refresh</i>
        Try Again
      </button>
    </div>
  </div>

  <!-- Content when not loading and no error -->
  <div *ngIf="!isLoading && !isError">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'common.search' | translate }}</mat-label>
      <input style="color: var(--text-color);" matInput (keyup)="applyFilter($event)" placeholder="{{ 'common.searchPlaceholder' | translate }}">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <div class="projects-table">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>{{ 'submittedProjects.tableHeaders.projectName' | translate }}</th>
          <th>{{ 'submittedProjects.tableHeaders.description' | translate }}</th>
          <th>{{ 'submittedProjects.tableHeaders.submissionDate' | translate }}</th>
          <th>{{ 'submittedProjects.tableHeaders.lastUpdated' | translate }}</th>
          <th>{{ 'submittedProjects.tableHeaders.status' | translate }}</th>
          <th>{{ 'submittedProjects.tableHeaders.actions' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let project of paginatedData; let i = index">
          <td>{{ i + 1 }}</td>
          <td>
            <span *ngIf="!shouldTruncate(project.projectName)">{{ project.projectName }}</span>
            <span *ngIf="shouldTruncate(project.projectName)">
              {{ getTruncatedText(project.projectName) }}
              <button class="view-more-btn" (click)="showFullTextPopup(project.projectName, 'projectName')">
                {{ 'projectDetails.actions.viewMore' | translate }}
              </button>
            </span>
          </td>
          <td>
            <span *ngIf="!shouldTruncate(project.description)">{{ project.description }}</span>
            <span *ngIf="shouldTruncate(project.description)">
              {{ getTruncatedText(project.description) }}
              <button class="view-more-btn" (click)="showFullTextPopup(project.description, 'description')">
                {{ 'projectDetails.actions.viewMore' | translate }}
              </button>
            </span>
          </td>
          <td>{{ project.submittedOn | date }}</td>
          <td>{{ project.updatedOn | date }}</td>
          <td [ngClass]="{
            'status-pending': project.status === 'PENDING',
            'status-approved': project.status === 'APPROVED',
            'status-declined': project.status === 'DECLINED'
          }">{{ project.status }}</td>
          <td>
            <button class="icon-button" (click)="viewProjectDetails(project)">
              <i class="material-icons">visibility</i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <button (click)="previousPage()" [disabled]="currentPage === 0">
      <i class="material-icons">chevron_left</i>
    </button>
    <span>{{ currentPage + 1 }} / {{ totalPages }}</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages - 1">
      <i class="material-icons">chevron_right</i>
    </button>
    <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
      <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
    </select>
  </div>
  </div>

  <!-- Full Text Popup Modal -->
  <div class="modal-overlay" *ngIf="showFullText" (click)="closeFullTextPopup()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ expandedField | titlecase }}</h3>
        <button class="close-btn" (click)="closeFullTextPopup()">
          <i class="material-icons">close</i>
        </button>
      </div>
      <div class="modal-body">
        <p>{{ expandedText }}</p>
      </div>
    </div>
  </div>
</div>
